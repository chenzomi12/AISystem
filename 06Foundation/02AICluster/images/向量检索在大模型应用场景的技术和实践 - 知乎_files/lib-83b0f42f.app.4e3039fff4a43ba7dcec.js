"use strict";(self.webpackChunkheifetz=self.webpackChunkheifetz||[]).push([[6272],{98211:function(t,e,n){n.d(e,{Ad:function(){return tl},Rj:function(){return te},Rv:function(){return tS},Tq:function(){return tM}});var r,o,a,i=n(20857),c=n(9338),s=n(22107),u=n(94707),l=n(87320),h=n(86325),f=n(55164),d=n(57477),p=n(71728),v=n(94009),_=n(79065),C=n(49899),g=n(85626),y=n(30971),b=n(87363),k=n(14168),w=n.n(k),m=n(43384),U=n(44259),T=n(87804),O=n(85879),D=n(24405),N=n(23579),Z=n(62264),E=n(87641),L=n(19706),V=n(76280),A=n(10421),R=n(30722),x=n(83697),I=n(41402),S=n(46323),P=n.n(S),M=n(65733),B=n(88329),G=n.n(B),z=n(25628),W=n.n(z);function j(){var t=(0,_._)(["\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n"]);return j=function(){return t},t}function F(){var t=(0,_._)(["\n  0% {\n    stroke-dasharray: 1, 95;\n    stroke-dashoffset: 0;\n  }\n  50% {\n    stroke-dasharray: 85, 95;\n    stroke-dashoffset: -25;\n  }\n  100% {\n    stroke-dasharray: 85, 95;\n    stroke-dashoffset: -93;\n  }\n"]);return F=function(){return t},t}function Y(){var t=(0,_._)(["\n        fill: transparent;\n        stroke: currentColor;\n        stroke-width: 5;\n        stroke-dasharray: 85, 95;\n        stroke-dashoffset: -25;\n        animation: "," 2s ease 0.5s infinite,\n          "," 2s linear infinite;\n      "]);return Y=function(){return t},t}function q(){var t=(0,_._)(["\n          fill: currentColor;\n          animation: "," 1s steps(12) infinite;\n        "]);return q=function(){return t},t}function X(){var t=(0,_._)(["\n  0% { opacity: 0; height: 225%; transform: translateY(100%); }\n  46% { opacity: 1; height: 100%; transform: translateY(0); }\n  100% { opacity: 0 }\n"]);return X=function(){return t},t}function H(){var t=(0,_._)(["\n  0% { opacity: 0; transform: scale(1) translateY(50%); }\n  38% { transform: scale(.83, 1) translateY(-8.8%); }\n  54% { opacity: 1; transform: scale(.94, 1) translateY(-14.7%); }\n  62% { transform: scale(1) translateY(-11.7%); }\n  75% { transform: scale(1.11, .94) translateY(20%); }\n  100% { transform: scale(1) translateY(0); }\n"]);return H=function(){return t},t}var $=!1,K=!1,J=(r=(0,c._)(function(t){var e;return(0,y.__generator)(this,function(n){switch(n.label){case 0:if(K)return[3,2];return[4,(K=!0,T.Z.ready().catch(function(){$=!0}))];case 1:n.sent(),n.label=2;case 2:if($)return[2,!0];return[4,T.Z.dispatch("account/showLoginDialog",{next:t}).catch(function(t){return t})];case 3:if("object"==typeof(e=n.sent())&&("ERR_AUTH_ALREADYLOGIN"===e.name||"ERR_ACOUNT_NOTGUEST"===e.name))return[2,$=!0];return[2,!1]}})}),function(t){return r.apply(this,arguments)}),Q=function(t){var e;return e=(0,c._)(function(e,n){var r,o,a;return(0,y.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t(e,n)];case 1:return[2,i.sent()];case 2:throw 400===(r=i.sent()).status&&18e4===r.code&&T.Z.supportsAction("base/unLockAccount").then(function(t){return t&&T.Z.dispatch("base/unLockAccount")}),r.toastMsg=(null===(o=r.payload)||void 0===o?void 0:null===(a=o.error)||void 0===a?void 0:a.message)||r.statusMessage,r;case 3:return[2]}})}),function(t,n){return e.apply(this,arguments)}},tt=(0,b.createContext)({loginCheck:function(){},fetcher:function(){}}),te=function(t){var e=t.loginCheck,n=t.loginCallbackUrl,r=t.contentType,o=t.contentId,a=t.actionType,i=t.zaContentType,c=t.children;if(!n&&!J)throw Error("loginCallbackUrl 或 loginCheck 必传其中一个, 不提供无法完成登录后页面回跳");var s=(0,U.wh)(),u=(0,b.useMemo)(function(){return{loginCheck:e||function(){return J(n)},fetcher:Q(s),contentType:r,contentId:o,actionType:a,zaContentType:i}},[e,s,n,r,o,a,i]);return(0,O.tZ)(tt.Provider,{value:u,children:c})};function tn(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reduce(function(t,e){return function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.call(this,e.apply(this,r))}})}te.propTypes={loginCheck:w().func,loginCallbackUrl:w().string,contentType:w().string,contentId:w().oneOfType([w().number,w().string]),actionType:w().string,zaContentType:w().string.isRequired};var tr=function(){function t(e,n,r,o){(0,s._)(this,t),this.fetcher=o,this.contentType=e,this.contentId="".concat(n),this.actionType=r,this.path="https://www.zhihu.com/api/v4/zreaction"}return(0,u._)(t,[{key:"getParams",value:function(t,e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"articles"===t.content_type?(0,d._)((0,f._)({},t),{action_value:"red_heart"===t.action_value?"like":t.action_value}):t}((0,f._)({content_type:this.contentType,content_id:this.contentId,action_type:this.actionType,action_value:t},e))}}]),t}(),to=function(t){(0,h._)(n,t);var e=(0,g._)(n);function n(t,r,o){return(0,s._)(this,n),e.call(this,t,r,"vote",o)}return(0,u._)(n,[{key:"getStatus",value:function(){return this.fetcher("".concat(this.path,"/count"),{query:this.getParams("up")})}},{key:"voteUp",value:function(){return this.fetcher(this.path,{method:"POST",body:this.getParams("up")})}},{key:"voteDown",value:function(){return this.fetcher(this.path,{method:"POST",body:this.getParams("down")})}},{key:"cancelUp",value:function(){return this.fetcher(this.path,{method:"DELETE",query:this.getParams("up")})}},{key:"cancelDown",value:function(){return this.fetcher(this.path,{method:"DELETE",query:this.getParams("down")})}}]),n}(tr),ta=function(t){return(0,c._)(function(){var e,n,r,o,a,i=arguments;return(0,y.__generator)(this,function(c){switch(c.label){case 0:for(n=Array(e=i.length),r=0;r<e;r++)n[r]=i[r];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,t.apply(this,n)];case 2:return(o=c.sent())&&(console.log("successToast",o),T.Z.dispatch("ui/showToast",{text:o})),[2,o];case 3:return console.log("errorToast",(a=c.sent())&&a.toastMsg||"服务忙，请稍后再试"),T.Z.dispatch("ui/showToast",{icon:"fail",text:a&&a.toastMsg||"服务忙，请稍后再试"}),[3,4];case 4:return[2]}})})},ti=function(t){return(0,c._)(function(){var e,n,r,o=arguments;return(0,y.__generator)(this,function(a){switch(a.label){case 0:for(n=Array(e=o.length),r=0;r<e;r++)n[r]=o[r];if(!this.context)throw Error("this.context 不存在, 是否忘记包装 <ToolBarProvider /> ?");return[4,(this.context.loginCheck||this.loginCheck).call(this)];case 1:if(!a.sent())return[3,3];return[4,t.apply(this,n)];case 2:return[2,a.sent()];case 3:return[2]}})})},tc=function(t,e,n){return function(r){return(0,c._)(function(){var o,a,i,c,s,u=arguments;return(0,y.__generator)(this,function(l){switch(l.label){case 0:for(a=Array(o=u.length),i=0;i<o;i++)a[i]=u[i];c=null,l.label=1;case 1:return l.trys.push([1,3,,4]),this.state&&(c=(0,f._)({},this.state),Array.isArray(n)&&0!==n.length&&n.forEach(function(t){delete c[t]})),[4,r.apply(this,a)];case 2:return[2,l.sent()];case 3:if(s=l.sent(),c&&this.setState(c),t&&t.call(this,s,c),!e)throw s;return[3,4];case 4:return[2]}})})}},ts=function(t){return(0,c._)(function(){var e,n,r,o,a,i,c=arguments;return(0,y.__generator)(this,function(s){switch(s.label){case 0:for(n=Array(e=c.length),r=0;r<e;r++)n[r]=c[r];if(a=(o=this.props).disabled,i=o.disabledMessage,a)return T.Z.dispatch("ui/showToast",{text:i}),[2];return[4,t.apply(this,n)];case 1:return[2,s.sent()]}})})},tu=(o=(0,c._)(function(){return(0,y.__generator)(this,function(t){switch(t.label){case 0:return[4,T.Z.supportsAction("iOS/hapticFeedback")];case 1:return t.sent()&&T.Z.dispatch("iOS/hapticFeedback"),[2]}})}),function(){return o.apply(this,arguments)}),tl=Object.freeze({NEUTRAL:Symbol("neutral"),VOTED_UP:Symbol("votedUp"),VOTED_DOWN:Symbol("votedDown"),VOTING_UP:Symbol("votingUp"),VOTING_DOWN:Symbol("votingDown"),CANCELING_UP:Symbol("cancelingUp"),CANCELING_DOWN:Symbol("cancelingDown")}),th=Object.freeze({NEUTRAL:tl.NEUTRAL,VOTED_UP:tl.VOTED_UP,VOTED_DOWN:tl.VOTED_DOWN});Object.freeze({VOTING_UP:tl.VOTING_UP,VOTING_DOWN:tl.VOTING_DOWN,CANCELING_UP:tl.CANCELING_UP,CANCELING_DOWN:tl.CANCELING_DOWN});var tf={type:"tween",duration:.2,ease:[0,0,.58,1]},td=function(){var t=!(arguments.length>0)||void 0===arguments[0]||arguments[0],e=(0,b.useRef)(t);return(0,b.useEffect)(function(){e.current=!1},[]),e.current};function tp(t,e,n,r){var o=(0,D.F)(),a=o.colors,i=a.GBK99B,c=a.GBL01A,s=td(),u=t?n?106:95:n?85:44;return[{initial:{width:s&&e?u:0,opacity:e?1:0},animate:{width:u,opacity:1},exit:{width:0,opacity:0},transition:tf},{initial:!1,animate:{color:n||r&&o.isDarkMode?i:c,width:u},transition:tf}]}var tv=(0,b.forwardRef)(function(t,e){return(0,O.tZ)(E.Flex,(0,d._)((0,f._)({role:"button",tabIndex:0},t),{ref:e,bg:"transparent",overflow:"hidden",height:"36px",fontWeight:"bold",fontSize:"12px",css:{position:"relative",userSelect:"none","&:active":{opacity:"0.5 !important"}}}))}),t_=(0,Z.d7)(tv),tC=(0,b.forwardRef)(function(t,e){return(0,O.tZ)(E.Flex,(0,d._)((0,f._)({},t),{ref:e,flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"hidden",width:"100%",height:"100%",css:{position:"absolute",top:0,left:0}}))}),tg=(0,Z.d7)(tC),ty=(0,I.F4)(j()),tb=(0,I.F4)(F()),tk=function(){return(0,O.tZ)("svg",{width:15,height:15,viewBox:"0 0 40 40",xmlns:"http://www.w3.org/2000/svg",css:(0,I.iv)(Y(),tb,ty),children:(0,O.tZ)("circle",{cx:"20",cy:"20",r:"15"})})},tw=function(){return(0,O.BX)("span",{css:{display:"inline-flex",alignItems:"center"},children:["​",(0,O.tZ)("svg",{viewBox:"0 0 35 35",width:15,height:15,css:(0,I.iv)(q(),ty),children:(0,O.BX)("g",{fillRule:"evenodd",children:[(0,O.tZ)("path",{d:"M17.5 9c-.825 0-1.5-.675-1.5-1.5v-6c0-.825.675-1.5 1.5-1.5S19 .675 19 1.5v6c0 .825-.675 1.5-1.5 1.5",opacity:".65"}),(0,O.tZ)("path",{d:"M21.75 10.139a1.504 1.504 0 0 1-.549-2.05l3-5.195a1.504 1.504 0 0 1 2.049-.55c.715.413.962 1.335.549 2.05l-3 5.196a1.504 1.504 0 0 1-2.049.549",opacity:".75"}),(0,O.tZ)("path",{d:"M24.861 13.25a1.504 1.504 0 0 1 .55-2.049l5.195-3a1.504 1.504 0 0 1 2.05.549 1.504 1.504 0 0 1-.55 2.049l-5.196 3a1.504 1.504 0 0 1-2.049-.549",opacity:".85"}),(0,O.tZ)("path",{d:"M26 17.5c0-.825.675-1.5 1.5-1.5h6c.825 0 1.5.675 1.5 1.5s-.675 1.5-1.5 1.5h-6c-.825 0-1.5-.675-1.5-1.5",opacity:".9"}),(0,O.tZ)("path",{d:"M24.861 21.75a1.504 1.504 0 0 1 2.05-.549l5.195 3c.715.412.962 1.334.55 2.049a1.504 1.504 0 0 1-2.05.549l-5.196-3a1.504 1.504 0 0 1-.549-2.049",opacity:".2"}),(0,O.tZ)("path",{d:"M21.75 24.861a1.504 1.504 0 0 1 2.049.55l3 5.195a1.504 1.504 0 0 1-.549 2.05 1.504 1.504 0 0 1-2.049-.55l-3-5.196a1.504 1.504 0 0 1 .549-2.049",opacity:".25"}),(0,O.tZ)("path",{d:"M17.5 26c.825 0 1.5.675 1.5 1.5v6c0 .825-.675 1.5-1.5 1.5s-1.5-.675-1.5-1.5v-6c0-.825.675-1.5 1.5-1.5",opacity:".3"}),(0,O.tZ)("path",{d:"M13.25 24.861c.714.413.961 1.335.549 2.05l-3 5.195a1.504 1.504 0 0 1-2.049.55 1.504 1.504 0 0 1-.549-2.05l3-5.196a1.504 1.504 0 0 1 2.049-.549",opacity:".35"}),(0,O.tZ)("path",{d:"M10.139 21.75a1.504 1.504 0 0 1-.55 2.049l-5.195 3a1.504 1.504 0 0 1-2.05-.549 1.504 1.504 0 0 1 .55-2.049l5.196-3a1.504 1.504 0 0 1 2.049.549",opacity:".4"}),(0,O.tZ)("path",{d:"M9 17.5c0 .825-.675 1.5-1.5 1.5h-6C.675 19 0 18.325 0 17.5S.675 16 1.5 16h6c.825 0 1.5.675 1.5 1.5",opacity:".45"}),(0,O.tZ)("path",{d:"M10.139 13.25a1.504 1.504 0 0 1-2.05.549l-5.195-3a1.504 1.504 0 0 1-.55-2.049 1.504 1.504 0 0 1 2.05-.549l5.196 3c.714.412.961 1.335.549 2.049",opacity:".5"}),(0,O.tZ)("path",{d:"M13.25 10.139a1.504 1.504 0 0 1-2.049-.55l-3-5.195a1.504 1.504 0 0 1 .549-2.05 1.504 1.504 0 0 1 2.049.55l3 5.196a1.504 1.504 0 0 1-.549 2.049",opacity:".55"})]})})]})},tm=function(){return(0,x.n)().Android?(0,O.tZ)(tk,{}):(0,O.tZ)(tw,{})},tU=(0,b.forwardRef)(function(t,e){var n=t.newDarkColor,r=t.show,o=t.voted,a=t.loading,i=t.votedUpCount,c=t.onClick,s=(0,v._)(tp(!0,r,o,n),2),u=s[0],l=s[1],h=(0,D.F)(),p=i>0?"，总赞同数 ".concat((0,R.Zh)(i)):"";return(0,O.tZ)(L.M,{children:r&&(0,O.tZ)(t_,(0,d._)((0,f._)({"aria-label":"".concat(o?"已赞同":"赞同").concat(p),ref:e},u),{onClick:a?null:c,children:(0,O.tZ)(tg,(0,d._)((0,f._)({},l),{children:a?(0,O.tZ)(tm,{css:{marginLeft:o?0:5}}):(0,O.BX)(O.HY,{children:[(0,O.tZ)(V.Ex,{css:{width:14,height:14,marginRight:6},center:!0}),(0,O.BX)(E.Text,{flexShrink:0,children:[o&&h&&n?"已赞同 ":"赞同 ",i>0&&(0,R.Zh)(i)]})]})}))}))})});tU.displayName="VoteUp";var tT=(0,b.forwardRef)(function(t,e){var n=t.newDarkColor,r=t.show,o=t.voted,a=t.loading,i=t.onClick,c=(0,v._)(tp(!1,r,o,n),2),s=c[0],u=c[1];return(0,O.tZ)(L.M,{children:r&&(0,O.tZ)(t_,(0,d._)((0,f._)({"aria-label":"已反对",ref:e},s),{onClick:a?null:i,children:(0,O.tZ)(tg,(0,d._)((0,f._)({},u),{children:a?(0,O.tZ)(tm,{}):(0,O.BX)(O.HY,{children:[(0,O.tZ)(A.y,{css:{width:14,height:14,marginRight:6},style:{marginRight:o?6:0},center:!0}),(0,O.tZ)(E.Text,{flexShrink:0,children:!!o&&"已反对"})]})}))}))})});tT.displayName="VoteDown";var tO=(a={},(0,l._)(a,tl.VOTING_UP,[1,1,0,1,0,0]),(0,l._)(a,tl.VOTED_UP,[1,0,1,0,0,0]),(0,l._)(a,tl.VOTED_DOWN,[0,0,0,1,0,1]),(0,l._)(a,tl.NEUTRAL,[1,0,0,1,0,0]),a),tD=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return t.current=t.current.map(function(t,e){return -1===n[e]?t:n[e]})},tN=function(t,e){switch(e){case tl.VOTED_UP:tD(t,1,0,1,0,-1,-1);return;case tl.VOTING_UP:tD(t,1,1,0,1,-1,-1);return;case tl.CANCELING_UP:tD(t,1,1,1,0,-1,-1);return;case tl.VOTED_DOWN:tD(t,0,-1,-1,1,0,1);return;case tl.VOTING_DOWN:tD(t,1,-1,-1,1,1,0);return;case tl.CANCELING_DOWN:tD(t,0,-1,-1,1,1,1);return;case tl.NEUTRAL:default:tD(t,1,0,0,1,0,0)}},tZ=function(t){var e=(0,b.useRef)(null),n=(0,b.useRef)(null);return e.current?t!==e.current&&tN(n,t):n.current=tO[t],e.current=t,n.current},tE=(0,b.forwardRef)(function(t,e){var n=t.newDarkColor,r=t.status,o=t.votedUpCount,a=t.onVoteUpClick,i=t.onVoteDownClick,c=t.onCancelClick,s=(0,p._)(t,["newDarkColor","status","votedUpCount","onVoteUpClick","onVoteDownClick","onCancelClick"]),u=(0,D.F)(),l=u.colors,h=l.GBL01A,_=l.GBL07A,C=(0,v._)(tZ(r),6),g=C[0],y=C[1],b=C[2],k=C[3],w=C[4],U=C[5],T=g&&k;return(0,O.BX)(Z.d7.div,(0,d._)((0,f._)({ref:e,css:{overflow:"hidden",position:"relative",display:"inline-flex",flexDirection:"row",alignItems:"center",height:36,borderRadius:18},initial:!1,animate:{backgroundColor:!T||n&&u.isDarkMode?h:(0,N.a)(h).alpha(.08)},transition:tf},s),{children:[(0,O.tZ)(m.$U,{as:tU,zaType:"Button",zaAction:b?"UnUpvote":"Upvote",newDarkColor:n,show:g,voted:b,votedUpCount:o,loading:y,onClick:y?null:b?c:a}),!!T&&(0,O.tZ)("div",{css:{background:_,height:18,width:1,opacity:.2}}),(0,O.tZ)(m.$U,{as:tT,zaType:"Button",zaAction:b?"UnDownvote":"Downvote",newDarkColor:n,show:k,voted:U,loading:w,onClick:w?null:U?c:i})]}))});function tL(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}tE.propTypes={newDarkColor:w().bool,status:w().oneOf(Object.values(tl)).isRequired,votedUpCount:w().number,onVoteUpClick:w().func,onVoteDownClick:w().func,onCancelClick:w().func},tE.displayName="VoteButtonBase";var tV=function(t){(0,h._)(n,t);var e=(0,g._)(n);function n(t){var r,o=t.defaultStatus,a=t.defaultVotedUpCount;(0,s._)(this,n),r=e.call(this),tL((0,i._)(r),"onError",function(t){r.props.onChange("error",r.state.votedUpCount,t)}),r.state={status:o||tl.VOTING_UP,votedUpCount:o?a:0},r.componentDidMount=ta(r.componentDidMount).bind((0,i._)(r));var u=tn(ts,ta,ti,tc(r.onError)),l=tn(function(t){return(0,c._)(function(){var e,n,r,o=arguments;return(0,y.__generator)(this,function(a){switch(a.label){case 0:for(n=Array(e=o.length),r=0;r<e;r++)n[r]=o[r];if(!this.context)throw Error("this.context 不存在, 是否忘记包装 <ToolBarProvider /> ?");return tu(),[4,t.apply(this,n)];case 1:return[2,a.sent()]}})})},u);return r.handleVoteUp=l(r.handleVoteUp).bind((0,i._)(r)),r.handleVoteDown=u(r.handleVoteDown).bind((0,i._)(r)),r.handleCancel=u(r.handleCancel).bind((0,i._)(r)),r}return(0,u._)(n,[{key:"componentDidMount",value:function(){var t=this;return(0,c._)(function(){var e,n,r,o,a,i,c,s,u,l;return(0,y.__generator)(this,function(h){switch(h.label){case 0:if(t.fetcher=new to((null===(e=t.context)||void 0===e?void 0:e.contentType)||t.props.contentType,(null===(n=t.context)||void 0===n?void 0:n.contentId)||t.props.contentId,null===(r=t.context)||void 0===r?void 0:r.fetcher),t.state.status!==tl.VOTING_UP)return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,t.fetcher.getStatus()];case 2:return a=(o=h.sent()).isVotedUp,i=o.isVotedDown,s=void 0===(c=o.votedUpCount)?0:c,u=null,u=a?tl.VOTED_UP:i?tl.VOTED_DOWN:tl.NEUTRAL,t.setState({status:u,votedUpCount:s}),[3,4];case 3:throw l=h.sent(),t.setState({status:tl.NEUTRAL,votedUpCount:0}),t.onError(l),delete l.toastMsg,l;case 4:return[2]}})})()}},{key:"handleVoteUp",value:function(){var t=this;return(0,c._)(function(){return(0,y.__generator)(this,function(e){switch(e.label){case 0:return t.setState({status:tl.VOTING_UP}),[4,t.fetcher.voteUp()];case 1:return e.sent(),t.setState(function(e){var n=e.votedUpCount+1;return t.props.onChange("voteUp",n),{status:tl.VOTED_UP,votedUpCount:n}}),[2,"已赞同"]}})})()}},{key:"handleVoteDown",value:function(){var t=this;return(0,c._)(function(){return(0,y.__generator)(this,function(e){switch(e.label){case 0:return t.setState({status:tl.VOTING_DOWN}),[4,t.fetcher.voteDown()];case 1:return e.sent(),t.props.onChange("voteDown",t.state.votedUpCount),t.setState({status:tl.VOTED_DOWN}),[2,"已反对"]}})})()}},{key:"handleCancel",value:function(){var t=this;return(0,c._)(function(){var e,n;return(0,y.__generator)(this,function(r){switch(r.label){case 0:if(e=t.state.status,n=t.props.onChange,e!==tl.VOTED_UP)return[3,2];return t.setState({status:tl.CANCELING_UP}),[4,t.fetcher.cancelUp()];case 1:return r.sent(),t.setState(function(t){var e=t.votedUpCount-1;return n("unVoteUp",e),{status:tl.NEUTRAL,votedUpCount:e}}),[2,"已取消"];case 2:if(e!==tl.VOTED_DOWN)return[3,4];return n("unVoteDown",t.state.votedUpCount),t.setState({status:tl.CANCELING_DOWN}),[4,t.fetcher.cancelDown()];case 3:return r.sent(),t.setState({status:tl.NEUTRAL}),[2,"已取消"];case 4:return[2]}})})()}},{key:"render",value:function(){var t=this.state,e=t.status,n=t.votedUpCount,r=this.props.contentId,o=this.context,a=o.contentId,i=o.zaContentType;return(0,O.tZ)(m.eV,{block:"ZReactionVoteButton",content:{id:"".concat(a||r),type:i},children:(0,O.tZ)(tE,{status:e,votedUpCount:n,onVoteUpClick:this.handleVoteUp,onVoteDownClick:this.handleVoteDown,onCancelClick:this.handleCancel})})}}]),n}(b.Component);tL(tV,"contextType",tt),tV.propTypes={defaultVotedUpCount:w().number,defaultStatus:w().oneOf(Object.values(th)),contentType:w().string,contentId:w().string,disabled:w().bool,disabledMessage:w().string,onChange:w().func},tV.defaultProps={onChange:function(){}};var tA=function(t){var e=(0,v._)(t,2),n=e[0],r=e[1];return{voteUpCount:n,status:r,condition:r===tl.VOTED_UP?1:r===tl.VOTED_DOWN?-1:0}},tR=function(t,e){var n=t.condition,r=t.voteUpCount,o=1===n,a=-1===n;switch(e.type){case"set":return(0,f._)({},t,e.payload);case"reset":return tA(e.payload);case"votingUp":return(0,d._)((0,f._)({},t),{status:tl.VOTING_UP,condition:a?-1:0});case"votedUp":return{status:tl.VOTED_UP,condition:1,voteUpCount:r+1};case"votingDown":return(0,d._)((0,f._)({},t),{status:tl.VOTING_DOWN,condition:o?1:0});case"votedDown":return{status:tl.VOTED_DOWN,condition:-1,voteUpCount:o?r-1:r};case"canceling":if(o)return(0,d._)((0,f._)({},t),{status:tl.CANCELING_UP});if(a)return(0,d._)((0,f._)({},t),{status:tl.CANCELING_DOWN});return t;case"canceled":if(o)return{status:tl.NEUTRAL,condition:0,voteUpCount:t.voteUpCount-1};if(a)return(0,d._)((0,f._)({},t),{status:tl.NEUTRAL,condition:0});return t;default:return t}},tx=function(t,e,n){var r=(0,b.useRef)(!0),o=(0,b.useRef)(tA([t,e])),a=(0,v._)((0,b.useReducer)(function(t,e){return o.current=tR(t,e),o.current},[t,e],function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return o.current=tA.apply(void 0,(0,C._)(e)),o.current}),2),i=a[0],s=a[1],u=(0,M.Z)(function(t,e){return s({type:t,payload:e})}),l=(0,M.Z)(function(){return o.current});return(0,b.useEffect)(function(){if(r.current){r.current=!1;return}u("reset",[t,e])},[u,t,e]),[i,u,l,function(t){return(0,M.Z)((0,c._)(function(){var e,r,o,a,c,s=arguments;return(0,y.__generator)(this,function(h){switch(h.label){case 0:for(r=Array(e=s.length),o=0;o<e;o++)r[o]=s[o];a=(0,f._)({},i),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,t.apply(void 0,(0,C._)(r))];case 2:return h.sent(),[3,4];case 3:throw c=h.sent(),u("set",a),n("error",l().voteUpCount,c),c;case 4:return[2]}})}))}]},tI={reactionFirst:!0},tS=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tI,o=r.reactionFirst,a=(0,b.useContext)(tt),i=(0,v._)(tx(t,e,n),4),s=i[0],u=s.voteUpCount,l=s.status,h=s.condition,f=i[1],d=i[2],p=i[3],_=(0,b.useMemo)(function(){return new to(a.contentType,a.contentId,a.fetcher)},[a]),C=p((0,c._)(function(){return(0,y.__generator)(this,function(t){switch(t.label){case 0:if(!a.loginCheck())return[2];return f(o?"votedUp":"votingUp"),[4,_.voteUp()];case 1:return t.sent(),o||f("votedUp"),n("voteUp",d().voteUpCount),[2]}})})),g=p((0,c._)(function(){return(0,y.__generator)(this,function(t){switch(t.label){case 0:if(!a.loginCheck())return[2];return f(o?"votedDown":"votingDown"),[4,_.voteDown()];case 1:return t.sent(),o||f("votedDown"),n("voteDown",d().voteUpCount),[2]}})})),k=p((0,c._)(function(){var t;return(0,y.__generator)(this,function(e){switch(e.label){case 0:if(!a.loginCheck())return[2];if(t=l===th.VOTED_UP,f(o?"canceled":"canceling"),!t)return[3,2];return[4,_.cancelUp()];case 1:return e.sent(),[3,4];case 2:return[4,_.cancelDown()];case 3:e.sent(),e.label=4;case 4:return o||f("canceled"),n(t?"unVoteUp":"unVoteDown",d().voteUpCount),[2]}})}));return{voteUpCount:u,status:l,voteUp:C,voteDown:g,cancel:k,isVotedUp:1===h,isVotedDown:-1===h,isNeutral:0===h}},tP=function(t){(0,h._)(n,t);var e=(0,g._)(n);function n(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"emojis",a=arguments.length>3?arguments[3]:void 0;return(0,s._)(this,n),e.call(this,t,r,o,a)}return(0,u._)(n,[{key:"chosen",value:function(t){return this.fetcher(this.path,{method:"POST",body:this.getParams(t)})}},{key:"unchosen",value:function(t){return this.fetcher(this.path,{method:"DELETE",query:this.getParams(t)})}}]),n}(tr),tM=function(t){var e=t.currentIsLiked,n=t.currentLikedCount,r=t.onChange,o=void 0===r?P():r,a=(0,b.useContext)(tt),i=(0,v._)((0,b.useState)(e),2),s=i[0],u=i[1],l=(0,v._)((0,b.useState)(n||0),2),h=l[0],f=l[1],d=(0,b.useMemo)(function(){return new tP(a.contentType,a.contentId,"like",a.fetcher)},[a]);return{like:(0,M.Z)((0,c._)(function(){return(0,y.__generator)(this,function(t){switch(t.label){case 0:if(!a.loginCheck())return[2];u(!0),f(h+1),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,d.chosen("like")];case 2:return t.sent(),o("like",h),[3,4];case 3:return t.sent(),u(!1),f(h-1),[3,4];case 4:return[2]}})})),unLike:(0,M.Z)((0,c._)(function(){return(0,y.__generator)(this,function(t){switch(t.label){case 0:if(!a.loginCheck())return[2];u(!1),f(h-1),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,d.unchosen("like")];case 2:return t.sent(),o("unlike",h),[3,4];case 3:return t.sent(),u(!0),f(h+1),[3,4];case 4:return[2]}})})),isLiked:s,count:h}},tB=function(t){return"//pic1.zhimg.com/v2-".concat(t,".png")},tG={red_heart:tB("3170e81c93aa76c576269af8e8a3e1f5"),cry_face:tB("6a33de7424ceafa6d086d9f832e36096"),hug:tB("7ca1782e2233623e752957471b568346"),onlooker:tB("e642ad48be2eb54121ac2dacf3b30d72"),lemon:tB("1aa9a01f31b63bd616b9b34aac0eb737"),doge:tB("57c51b6093cd2cfcf9432da7389c8ffb"),tears_face:tB("7238f26b4e7fc6567a98f1fec600b451"),thinking_face:tB("5d3f5d64e3ea9e022ef8580eeed7c3cc"),trolling_face:tB("d653b16e616083ca3d147b0db06172ff"),pleading_face:tB("9b92a403966de6b93bc2ca961512da23"),rolling_eyes_face:tB("0069b69ea0022451cb82c5702bd3d029")};Object.keys(tG).forEach(function(t){tG[t.toUpperCase()]=tG[t]});var tz=(0,b.createContext)({}),tW=function(t){var e=t.name,n=t.count,r=t.totalCount,o=t.actionList,a=t.children,i=(0,b.useMemo)(function(){return{name:e,count:n,totalCount:r,actionList:o}},[e,n,r,o]);return(0,O.tZ)(tz.Provider,{value:i,children:a})};function tj(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var tF=function(t){(0,h._)(n,t);var e=(0,g._)(n);function n(t){(0,s._)(this,n),r=e.call(this),tj((0,i._)(r),"onRef",function(t){r.domRef=t,r.props.onRef(t)}),tj((0,i._)(r),"addCheckBeforeClick",function(t){if(t.checkBeforeClick){var e=r.handleClick;r.handleClick=function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];r.props.checkBeforeClick?r.props.checkBeforeClick(function(){e.apply((0,i._)(r),n)}):e.apply((0,i._)(r),n)}}}),tj((0,i._)(r),"customShowToast",function(t){return(0,c._)(function(){var e,n,r,o,a,i=arguments;return(0,y.__generator)(this,function(c){switch(c.label){case 0:for(n=Array(e=i.length),r=0;r<e;r++)n[r]=i[r];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,t.apply(this,n)];case 2:return(o=c.sent())&&this.props.onShowToast&&this.props.onShowToast(o),[3,4];case 3:return a=c.sent(),this.props.onShowToast&&this.props.onShowToast(a&&a.toastMsg||"服务忙，请稍后再试"),[3,4];case 4:return[2]}})})}),tj((0,i._)(r),"getTotalCount",function(t){return t&&0!==t.length?t.reduce(function(t,e){return t+e.count},0):0}),tj((0,i._)(r),"formatActionList",function(t,e){return t&&0!==t.length?t.map(function(t,n){return r.actionListIndexMap[t.name]=n,(0,d._)((0,f._)({},t),{chosen:t.name===e})}):[]}),tj((0,i._)(r),"changeActionList",function(t,e,n){return t.map(function(t){var r=t.name,o=t.chosen,a=t.count;o&&(a-=1);var i=r===e;return{name:r,chosen:i,count:i?n:a}})}),tj((0,i._)(r),"doChange",function(t){r.setState(function(e){var n=e.name,o=e.actionList,a=0;if(t){var i=t===n?0:1;a=o[r.actionListIndexMap[t]].count+i}var c=r.changeActionList(o,t,a);return{name:t,count:a,actionList:c,totalCount:r.getTotalCount(c)}})}),tj((0,i._)(r),"closePopover",function(){r.setState({showPopover:!1})}),tj((0,i._)(r),"onError",function(t){return r.props.onChange("error",(0,f._)({},r.state),t)});var r,o=t.defaultName,a=t.defaultCount,u=t.defaultActionList;r.actionListIndexMap={},r.state={name:o,count:a||0,actionList:r.formatActionList(u,o)||[],totalCount:r.getTotalCount(u)};var l=tn(t.onShowToast?r.customShowToast:ta,ti,tc(r.onError,!1));return r.handleClick=l(r.handleClick).bind((0,i._)(r)),r.addCheckBeforeClick(t),r}return(0,u._)(n,[{key:"componentDidMount",value:function(){var t=this.props.toolBar,e=t.contentType,n=t.contentId,r=t.actionType,o=t.fetcher;this.fetcher=new tP(e,n,r,o)}},{key:"loginCheck",value:function(){return this.props.toolBar.loginCheck()}},{key:"doFetch",value:function(t){return t?this.fetcher.chosen(t):this.fetcher.unchosen(null)}},{key:"afterChange",value:function(t){this.props.onChange(t?"chosen":"unchosen",(0,f._)({},this.state))}},{key:"handleClick",value:function(){var t=this;return(0,c._)(function(){var e,n,r,o;return(0,y.__generator)(this,function(a){switch(a.label){case 0:if(t.props.disabled)return[2];return n=(e=t.state).name,r=e.actionList,o=n?null:r[0].name,t.doChange(o,!1),o&&tu(),[4,t.doFetch(o)];case 1:return a.sent(),t.afterChange(o),[2]}})})()}},{key:"render",value:function(){var t,e=this.props,n=e.disabled,r=(e.onRef,e.children),o=(0,p._)(e,["disabled","onRef","children"]),a=this.state,i=a.name,c=a.count,s=a.totalCount,u=a.actionList;return(0,O.tZ)(tW,{name:i,count:c,totalCount:s,actionList:u,children:(0,O.tZ)(m.eV,{block:"ZReactionReactionButton",children:(0,O.tZ)(m.$U,(0,d._)((0,f._)({as:E.Box,zaType:"Button",zaAction:i?"UnLike":"Like",zaText:i||(null===(t=u[0])||void 0===t?void 0:t.name),ref:this.onRef,css:{position:"relative",display:"flex","&:active":{opacity:.5}},style:{opacity:n?.5:1}},o),{role:"button",tabIndex:0,"aria-label":"".concat(i?"已喜欢":"喜欢").concat(s>0?"，共被喜欢".concat((0,R.Zh)(s),"次"):""),onClick:this.handleClick,children:r}))})})}}]),n}(b.Component),tY=function(t){var e=(0,b.useContext)(tt);return(0,O.tZ)(tF,(0,f._)({toolBar:e},t))};tY.propTypes={defaultName:w().oneOf(Object.keys(tG)),defaultCount:w().number,defaultActionList:w().arrayOf(w().shape({name:w().oneOfType([w().number,w().string]),count:w().number})),disabled:w().bool,onRef:w().func,onChange:w().func,onShowToast:w().func,checkBeforeClick:w().func},tY.defaultProps={onRef:G(),onChange:G()};var tq=(0,b.forwardRef)(function(t,e){var n=t.size,r=t.text,o=t.center,a=(0,p._)(t,["text","center"]);r&&(n="1.2em");var i=(0,O.tZ)("svg",(0,f._)({ref:e},a,n&&{width:n,height:n}));return o?(0,O.BX)("span",{ref:e,style:tq.strutStyle,children:["​",i]}):i});tq.defaultProps={fill:"currentColor"},tq.strutStyle={display:"inline-flex",alignItems:"center"};var tX=(0,I.F4)(X()),tH=(0,I.F4)(H()),t$=function(t){var e=t.freeze,n=t.size,r=t.left,o=t.right,a=(0,D.F)().colors.GRD01A,i=Math.round(.16*n);return(0,O.tZ)("div",{css:{position:"absolute",width:i,height:i,top:r||o?"-18%":"-28%",left:r?"2%":o?"auto":"42%",right:o?"2%":"auto",transform:r?"rotate(-25deg)":o?"rotate(-335deg)":"none",transformOrigin:"50% ".concat(.08*n,"px")},children:(0,O.tZ)("div",{css:{background:a,height:"100%",minHeight:"100%",borderRadius:.08*n,opacity:0,animation:e?null:"".concat(tX," .5s linear forwards")}})})},tK=(0,b.forwardRef)(function(t,e){var n=t.className,r=t.size,o=t.noAnimation,a=(0,D.F)().colors.GRD01A,i=(0,b.useRef)(o).current;return(0,O.BX)("div",{ref:e,className:W()("HeartIcon",n),css:{position:"absolute",width:r,height:r},children:[(0,O.tZ)(t$,{freeze:i,size:r,left:!0}),(0,O.tZ)(t$,{freeze:i,size:r}),(0,O.tZ)(t$,{freeze:i,size:r,right:!0}),(0,O.tZ)(tq,{size:r,viewBox:"0 0 24 24",css:{position:"absolute",top:0,left:0,fill:a,stroke:a,strokeWidth:"1.5px",animation:i?null:"".concat(tH," .5s linear forwards")},children:(0,O.tZ)("path",{d:"M21.3871 10.8644C21.7339 6.89688 18.9681 4.06581 15.9842 4.06581C14.4071 4.06581 12.8344 4.94922 11.9967 6.05139C11.2104 4.96015 9.59294 4.06582 8.01579 4.06582C5.03186 4.06582 2.26571 6.89693 2.61294 10.8644C2.99689 15.2513 9.96356 21.0153 11.9917 21.0153C14.0197 21.0153 21.0083 15.1977 21.3871 10.8644Z",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),tJ=(0,b.forwardRef)(function(t,e){var n=t.className;return(0,O.tZ)(tq,{ref:e,className:W()("OutLineIcon",n),viewBox:"0 0 24 24",css:{position:"absolute",top:0,left:0,fill:"none",stroke:"currentColor",strokeWidth:"1.5px"},children:(0,O.tZ)("path",{d:"M21.3871 10.8644C21.7339 6.89688 18.9681 4.06581 15.9842 4.06581C14.4071 4.06581 12.8344 4.94922 11.9967 6.05139C11.2104 4.96015 9.59294 4.06582 8.01579 4.06582C5.03186 4.06582 2.26571 6.89693 2.61294 10.8644C2.99689 15.2513 9.96356 21.0153 11.9917 21.0153C14.0197 21.0153 21.0083 15.1977 21.3871 10.8644Z",strokeLinecap:"round",strokeLinejoin:"round"})})});(0,Z.d7)(tK),(0,Z.d7)(tJ),w().string,w().number,w().string;var tQ=(0,b.createContext)({});w().func,w().string,w().string.isRequired,w().string.isRequired,w().object.isRequired;var t0=function(t){var e=(0,v._)((0,b.useState)(function(){return t.options?Object.keys(t.options).reduce(function(e,n){return e[n]=(0,f._)({},t.options[n]),t.reactedOption&&(e[n].selected=!0),e},{}):null}),2),n=e[0],r=e[1];return{options:n,setOptions:r,selectOption:function(t){var e=Object.keys(n).reduce(function(e,r){var o=(0,f._)({count:0},n[r]);return o.selected&&(o.selected=!1,o.count--),r===t&&(o.selected=!0,o.count++),e.totalCount+=o.count,o.loading=!1,e.data[r]=o,e},{data:{},totalCount:0});return r(e.data),e},setOptionLoading:function(t){r(Object.keys(n).reduce(function(e,r){var o=(0,f._)({count:0},n[r]);return o.selected||r===t?o.loading=!0:o.loading=!1,e[r]=o,e},{}))}}},t1=function(t,e,n){var r,o=(0,b.useContext)(tQ),a=o.getData,i=o.fetcher,s=o.loginCheck,u=i(t),l=a(t),h=(0,v._)((0,b.useState)(!1),2),f=h[0],d=h[1],p=(0,v._)((0,b.useState)(l.count||0),2),_=p[0],C=p[1],g=t0(l),k=g.options,w=g.setOptions,m=g.selectOption,U=g.setOptionLoading,T=!!k,O=(0,v._)((0,b.useState)(T?l.reactedOption:l.reacted),2),D=O[0],N=O[1],Z=function(){d(!1),C(_),N(D),w(k)},E=function(t){d(!0),T&&U(t)},L=(r=(0,c._)(function(t){var r,o;return(0,y.__generator)(this,function(a){switch(a.label){case 0:if(!s())return[2];r=function(){d(!1);var e=T?m(t):{data:null,totalCount:D?_:_+1};C(e.totalCount);var r=!T||t;N(r),n(t,{totalCount:e.totalCount,options:e.data,selected:r})},a.label=1;case 1:if(a.trys.push([1,4,,5]),e?r():E(t),D)return[3,3];return[4,u.select(t)];case 2:a.sent(),a.label=3;case 3:return e||r(),[3,5];case 4:return o=a.sent(),Z(),n("error",{totalCount:_,selected:D,options:k},o),[3,5];case 5:return[2]}})}),function(t){return r.apply(this,arguments)}),V=(0,M.Z)((0,c._)(function(){var t,r;return(0,y.__generator)(this,function(o){switch(o.label){case 0:if(!s())return[2];t=function(){d(!1);var t=T?m():{data:null,totalCount:D?_-1:_};C(t.totalCount);var e=!!T&&null;N(e),n("cancel",{canceled:D,totalCount:t.totalCount,options:t.data,selected:e})},o.label=1;case 1:if(o.trys.push([1,4,,5]),e?t():E(),!D)return[3,3];return[4,u.cancel(D)];case 2:o.sent(),o.label=3;case 3:return e||t(),[3,5];case 4:return r=o.sent(),Z(),n("error",{totalCount:_,selected:D,options:k},r),[3,5];case 5:return[2]}})}));return{totalCount:_,loading:f,selected:D,options:k,select:L,cancel:V}};w().bool,w().func;var t5=["RED_HEART","CRY_FACE","HUG","ONLOOKER"],t4=function(t,e){return t.map(function(t){var n=e[t]||{},r=n.count;return{name:t,chosen:n.selected,count:r}})};(0,b.forwardRef)(function(t,e){var n,r,o=t.iconOrder,a=void 0===o?t5:o,i=t.disabled,c=t.children,s=t.onChange,u=void 0===s?G():s,l=(0,p._)(t,["iconOrder","disabled","children","onChange"]),h=(0,b.useRef)(null),v=(0,b.useRef)(null),_=t1("EMOJI",!0,function(t,e,n){u(t,(0,d._)((0,f._)({},e),{actionList:t4(a,e.options)}),n)}),C=_.options,g=_.selected,y=_.totalCount,k=_.select,w=_.cancel;v.current=a;var U=(null===(n=C[g])||void 0===n?void 0:n.count)||0,T=(0,b.useMemo)(function(){return t4(a,C)},[C]),D=(0,b.useCallback)(function(t){"function"==typeof e?null==e||e(t):e&&(e.current=t),h.current=t},[]),N=(0,M.Z)(function(){i||(g||tu(),g?w():k(T[0].name))});return(0,O.tZ)(tW,{name:g,count:U,totalCount:y,actionList:T,children:(0,O.tZ)(m.$U,(0,d._)((0,f._)({as:E.Box,zaType:"Button",zaAction:g?"UnLike":"Like",zaText:g||(null===(r=T[0])||void 0===r?void 0:r.name),ref:D,css:{position:"relative",display:"flex","&:active":{opacity:.5}}},l),{role:"button",tabIndex:0,"aria-label":"".concat(g?"已喜欢":"喜欢").concat(y>0?"，共被喜欢".concat((0,R.Zh)(y),"次"):""),onClick:N,children:c}))})}).propTypes={iconOrder:w().arrayOf(w().string),disabled:w().bool,onChange:w().func}}}]);
//# sourceMappingURL=lib-83b0f42f.app.4e3039fff4a43ba7dcec.js.map